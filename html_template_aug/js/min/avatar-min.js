!function(t,e){"function"==typeof define&&define.amd?define(function(){return t.AvatarUpload=e()}):t.AvatarUpload=e()}(this,function(){var t=function(t,e){return Object.keys(e).forEach(function(r){t[r]=e[r]})},e=function(t){try{return JSON.parse(t)}catch(e){return!1}},r=function(e){if(t(this.config,e),!this.config.el)throw new Error("An element is required to manipulate");if(!this.config.uploadUrl&&!this.config.pretendUpload)throw new Error("Upload URL not specified");this.el=this.config.el,this.renderInput(),this.bindInput(),this.progressText=this.el.querySelector("span"),this.imageWrapper=this.el.querySelector(".avatar-upload__image-wrapper")};r.prototype.config={el:void 0,uploadUrl:"",uploadMethod:"post",uploadImageKey:"upload",uploadData:{},pretendUpload:!1,onProgress:void 0,onSuccess:void 0,onError:void 0},r.prototype.renderInput=function(){var t=this.el.querySelector("img"),e=t.src,r=document.createElement("div");return r.className="avatar-upload__shell",r.innerHTML=['<div class="avatar-upload__wrapper avatar-upload--complete">','<div class="avatar-upload__image-wrapper">','<img src="'+e+'">',"</div>",'<img src="'+e+'" class="avatar-upload__faded-image">','<div class="avatar-upload__progress-wrapper">',"<span>0%</span>","</div>",'<input type="file">',"</div>"].join(""),t.parentNode.removeChild(t),this.el.appendChild(r),this},r.prototype.bindInput=function(t){this.el.querySelector("input").addEventListener("change",this.initiateUpload.bind(this),!0)},r.prototype.initiateUpload=function(t){var e=t.target.files[0];if(t.target.value=null,e.type.match(/image.*/)){var r=new FileReader;r.onload=this.displayUpload.bind(this),r.readAsDataURL(e),this.upload(e)}},r.prototype.displayUpload=function(t){var e=t.target.result;this.uiUploadStart(e)},r.prototype.upload=function(t){var e=this.config.pretendUpload?o:a;e(t,this.config,{progress:this.uploadProgress.bind(this),success:this.uploadSuccess.bind(this),error:this.uploadError.bind(this)})},r.prototype.uploadProgress=function(t){this.uiUploadProgress(t),this.config.onProgress&&this.config.onProgress(t,this.el,this)},r.prototype.uploadSuccess=function(t,e){this.uiUploadSuccess(t,e),this.config.onSuccess&&this.config.onSuccess(t,e)},r.prototype.uploadError=function(t,e){this.uiUploadError(t,e),this.config.onError&&this.config.onError(t,e)},r.prototype.uiUploadStart=function(t){var e;Array.prototype.forEach.call(this.el.querySelectorAll("img"),function(r){e=r.src,r.src=t}),this.origSrc=e,this.el.querySelector(".avatar-upload__wrapper").className="avatar-upload__wrapper"},r.prototype.uiUploadProgress=function(t){this.progressText.textContent=t+"%",this.imageWrapper.style.width=t+"%"},r.prototype.uiUploadSuccess=function(t,e){this.progressText.textContent="0%",this.imageWrapper.style.width=null,this.el.querySelector(".avatar-upload__wrapper").className="avatar-upload__wrapper avatar-upload--complete"},r.prototype.uiUploadError=function(t,e){this.uiUploadSuccess();var r=this.origSrc;Array.prototype.forEach.call(this.el.querySelectorAll("img"),function(t){t.src=r})};var o=function(t,e,r){var o=0,a=setInterval(function(){return o+=1,o>100?(r.success(),clearInterval(a)):void r.progress(o)},50)},a=function(t,r,o){var a=new XMLHttpRequest,i=new FormData;a.upload.addEventListener("progress",function(t){o.progress(parseInt(t.loaded/t.total*100,10))}),a.onreadystatechange=function(t){4===a.readyState&&(200===a.status?o.success(a,e(a.response)):o.error(a,e(a.response)))},i.append(r.uploadImageKey,t);for(val in r.uploadData)i.append(val,r.uploadData[val]);a.open(r.uploadMethod,r.uploadUrl),a.send(i)};return r});