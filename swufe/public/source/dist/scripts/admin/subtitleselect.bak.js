window.JLib=window.JLib||{},define([],function(){function e(){this.config={},this.mask=null}function t(e){return"object"!=typeof e?$.parseJSON(e):e}var l=e.prototype;return l.tplStartElem='<span class="clip-share-start hidden" id="select_start" title="Clip start"></span>',l.tplEndElem='<span class="clip-share-end hidden" id="select_end" title="Clip end"></span>',l.init=function(e){var t=this;t.config.cfg=e,t.container=e.container,t.videoCont=null,t.ctlObj=t.container.parents(".panel-box"),t.ctlObjBox=t.ctlObj.find(".subtitle-box"),t.ctlScrollObj=t.ctlObj.find(".subtitle-content"),t.ctlSubtitleCont=t.container,t.previewCont=e.previewContainer,t.previewIframe=t.previewCont.find("iframe"),t.config.lineHeight=t.lineHeight,t.initDom(),t.subtitleElemEvent(),t.startElemEvent(),t.endElemEvent(),t.mouseup()},l.initDom=function(){{var e=this;e.config}e.ctlObj.addClass("subtitle-edit"),e.startElem=$(e.tplStartElem).appendTo(e.ctlObjBox),e.startElemActive=!1,e.endElem=$(e.tplEndElem).appendTo(e.ctlObjBox),e.endElemActive=!1,e.config.ctlElemWidth=e.startElem.width(),e.config.ctlElemHeight=e.startElem.height()},l.destroy=function(){var e=this,t=e.config;e.ctlObj.removeClass("subtitle-edit"),e.startElem.remove(),e.endElem.remove(),e.subtitleLine.eq(t.currentLine).addClass("current-line"),e.ctlSubtitleCont.find(".selected-line").removeClass("selected-line"),e.ctlSubtitleCont.find(".selected-word").removeClass("selected-word"),e.ctlSubtitleCont.find(".selected-space").removeClass("selected-space"),e.ctlObjBox.off("mousedown").off("mousemove")},l.setLimit=function(){var e=this;e.ctlObjBoxWidth||(e.ctlObjBoxWidth=e.ctlObjBox.width(),e.ctlObjBoxHeight=e.ctlObjBox.height())},l.subtitleElemEvent=function(){function e(c){if(t.subtitleElemActive=!0,t.subtitleElemMoved){t.subtitleElemMoved=!1;var d=o.offset();a=c.pageX-d.left,r=c.pageY-d.top;var m=0,p=0,f=0,h=0,u=0,g=0,v=16,E=t.ctlObjBoxWidth+16,b=10,w=t.ctlObjBoxHeight+10;s=v>s?v:s,s=s>E?E:s,n=b>n?b:n,n=n>w?w:n,a=v>a?v:a,a=a>E?E:a,r=b>r?b:r,r=r>w?w:r,(n>r||n==r&&s>a)&&(u=n,n=r,r=u,g=s,s=a,a=g),m=n,p=s-l.ctlElemWidth,p=v>p?v:p,f=r-l.ctlElemHeight,h=a,0>f-m&&(f=m),h-p<l.ctlElemWidth&&(h=p+l.ctlElemWidth),t.clearWinSelection(),t.startElem.css({top:m,left:p}),t.endElem.css({top:f,left:h}),t.setClipInfo(),t.updateElemPos(),window.startTime=l.clipStartTime,window.endTime=l.clipEndTime}i.off("mouseup",e)}var t=this,l=t.config,o=t.ctlObjBox,i=$("body"),s=0,n=0,a=0,r=0;o.mousedown(function(a){if(t.setLimit(),l.mouseIsMove=!0,!t.startElemActive&&!t.endElemActive){var r=o.offset();t.subtitleElemActive=!0,s=a.pageX-r.left,n=a.pageY-r.top,i.mouseup(e)}}),o.mousemove(function(e){if(l.mouseIsMove=!0,!t.startElemActive&&!t.endElemActive&&t.subtitleElemActive){var i=o.offset(),a=e.pageX-i.left,r=e.pageY-i.top,c=10;(Math.abs(a-s)>c||Math.abs(r-n)>c)&&(t.subtitleElemMoved=!0)}})},l.startElemEvent=function(){var e=this,t=(e.config,e.startElem),l=0,o=0,i=0,s=0,n=0;t.click(function(e){e.stopPropagation()}),t.mousedown(function(t){var a=e.mousedown({target:"start",X:t.pageX,Y:t.pageY});l=a.top,o=a.left,i=a.otherTop,s=a.otherLeft,n=a.scrollTop}),$("body").mousemove(function(t){e.startElemActive&&e.mousemove({target:"start",elemTop:l,elemLeft:o,otherTop:i,otherLeft:s,X:t.pageX,Y:t.pageY,scrollTop:n})})},l.endElemEvent=function(){var e=this,t=(e.config,e.endElem),l=0,o=0,i=0,s=0,n=0;t.click(function(e){e.stopPropagation()}),t.mousedown(function(t){var a=e.mousedown({target:"end",X:t.pageX,Y:t.pageY});l=a.otherTop,o=a.otherLeft,i=a.top,s=a.left,n=a.scrollTop}),$("body").mousemove(function(t){e.endElemActive&&e.mousemove({target:"end",elemTop:i,elemLeft:s,otherTop:l,otherLeft:o,X:t.pageX,Y:t.pageY,scrollTop:n})})},l.mousedown=function(e){var t=this;t.setLimit(),t.clearWinSelection();var l=null,o=null;$("body").addClass("disable-select-text"),t.ctlScrollObj.addClass("disable-select-text"),"start"==e.target&&(t.targetElem=l=t.startElem,o=t.endElem,t.startElemActive=!0),"end"==e.target&&(t.targetElem=l=t.endElem,o=t.startElem,t.endElemActive=!0),t.config.orginalX=e.X,t.config.orginalY=e.Y;var i=l.position(),s=o.position();return{top:i.top,left:i.left,otherTop:s.top,otherLeft:s.left,scrollTop:t.ctlScrollObj.startTop()}},l.mousemove=function(e){var t=this,l=t.config,o=null,i=null,s=16-l.ctlElemWidth,n=0,a=0,r=0,c=0,d=0,m=0,p=0;t.addMask();var f=e.elemTop+(e.Y-l.orginalY)+(t.ctlScrollObj.scrollTop()-e.scrollTop),h=e.elemLeft+(e.X=l.orginalX);"start"==e.target&&(o=t.startElem,i=t.endElem,n=10,a=t.ctlObjBoxWidth-l.ctlElemWidth+16,r=e.otherTop,f=Math.floor(f/l.lineHeight)*l.lineHeight+10,h>e.otherLeft-l.ctlElemWidth&&f>r-l.ctlElemHeight&&(f=r-l.ctlElemHeight),f=Math.min(Math.max(n,f),r),f>=e.otherTop&&h>e.otherLeft-l.ctlElemWidth&&(h=e.otherLeft-l.ctlElemWidth),h=Math.min(Math.max(s,h),a),c=f,d=h+l.ctlElemWidth,m=e.otherLeft,p=e.otherTop+l.ctlElemHeight),"end"==e.target&&(o=t.endElem,i=t.startElem,n=e.otherTop,r=t.ctlObjBoxHeight-l.ctlElemHeight+10,a=t.ctlObjBoxWidth+16,f=Math.floor(f/l.lineHeight)*l.lineHeight+10,h<e.otherLeft+l.ctlElemWidth&&f<n+l.ctlElemHeight&&(f=n+l.ctlElemHeight),f=Math.min(Math.max(n,f),r),f<=e.otherTop&&h<e.otherLeft+l.ctlElemWidth&&(h=e.otherLeft+l.ctlElemWidth),h=Math.min(Math.max(s,h),a),c=e.otherTop,d=e.otherLeft+l.ctlElemWidth,m=h,p=f+l.ctlElemHeight),o.css({left:h,top:f}),t.setSelected({top:c,left:d,right:m,bottom:p}),t.setClipInfo()},l.mouseup=function(){var e=this,t=e.config,l=$("body");l.mouseup(function(){(e.startElemActive||e.endElemActive)&&(e.startElemActive&&(e.startElemActive=!1),e.endElemActive&&(e.endElemActive=!1),l.removeClass("disable-select-text"),e.ctlScrollObj.removeClass("disable-select-text"),e.delMask(),e.updateElemPos(),window.startTime=t.clipStartTime,window.endTime=t.clipEndTime)})},l.addMask=function(){var e=this;e.mask||(e.mask=$('<div class="clip-mask" onselectstart="return false;"></div>').appendTo($("body")))},l.delMask=function(){var e=this;e.mask&&(e.mask.remove(),e.mask=null)},l.clearWinSelection=function(){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()},l.getTipsTime=function(e){e=Math.floor(e);var t=Math.floor(e/60),l=e-60*t;return t+"' "+l+'"'},l.setSubtitleLine=function(e){var t=this,l=t.config;if(e){t.stopAutoScroll(),t.subtitleLine=e;for(var o=t.subtitleLine.length,i=0;o>i;i++){var s=t.subtitleLine.eq(i);s.data("top",s.position().top).attr("top",s.position().top)}t.setCtlPos(void 0==l.currentLine?0:l.currentLine)}else alert("Subtitle loading."),t.destroy()},l.setCtlPos=function(e){var t=this,l=t.config;t.setLimit();var o=t.subtitleLine.eq(e),i=null,s=t.subtitleLine.length,n=s-1-e;i=t.subtitleLine.eq(n>=4?e+4:e+n);var a=parseFloat(o.attr("top")),r=parseFloat(i.attr("top")),c=16-l.ctlElemWidth,d=o.children(".word").eq(-1),m=d.position().left+d.width()+16;t.startElem.css({top:a,left:c}).removeClass("hidden"),t.endElem.css({top:r,left:m}).removeClass("hidden"),t.setSelected({top:a,left:c+l.ctlElemWidth,right:m,bottom:r+l.ctlElemHeight}),t.setClipInfo(),t.updateElemPos(),window.startTime=l.clipStartTime,window.endTime=l.clipEndTime,t.ctlScrollObj.scrollTop(t.startElem.position().top-2*l.lineHeight)},l.stopAutoScroll=function(){var e=this,t=e.player;t&&(t.config.isClipMode=!0)},l.autoScroll=function(){var e=this,t=e.player;t&&(t.config.isClipMode=!1)},l.setSelected=function(e){for(var t=this,l=(t.config,null),o=null,i=-1,s=null,n=null,a=t.subtitleLine.length,r=0;a>r;r++){var c=t.subtitleLine.eq(r),d=parseFloat(c.attr("top"));if(l=c,c.removeClass("selected-line"),c.find(".word").removeClass("selected-word"),c.find(".space").removeClass("selected-space"),e.top>-d&&e.top<d+c.height()){c.addClass("selected-line");for(var m=c.find(".word"),p=m.length,f=0;p>f;f++){var h=m.eq(f),u=h.position(),g=u.top,v=u.left;e.top>=g&&e.top<g+h.height()&&e.left>=v&&e.left<v+h.width()&&(o=h,i=f),null!=o&&(h.addClass("selected-word"),h.next(".space").addClass("selected-space"))}break}}for(r=parseFloat(l.attr("index"));a>r;r++)if(c=t.subtitleLine.eq(r),d=parseFloat(c.attr("top")),e.bottom>d&&e.bottom<=d+c.height())if(s=c,m=c.find(".word"),p=m.length,parseFloat(s.attr("index"))==parseFloat(l.attr("index"))){if(null!=o)for(f=i;p>f;f++)h=m.eq(f),u=h.position(),g=u.top,v=u.left,e.bottom>g&&e.bottom<=g+h.height()&&e.right>=v&&e.right<v+h.width()&&(n=h),null!=n&&(h.removeClass("selected-word"),h.next(".space").removeClass("selected-space"))}else for(f=0;p>f;f++)h=m.eq(f),u=h.position(),g=u.top,v=u.left,h.addClass("selected-word"),h.next(".space").addClass("selected-space"),e.bottom>g&&e.bottom<=g+h.height()&&e.right>=v&&e.right<v+h.width()&&(n=h),null!=n&&(h.removeClass("selected-word"),h.next(".space").removeClass("selected-space"));else r!=parseFloat(l.attr("index"))&&(null==s?(c.addClass("selected-line"),c.find(".word").addClass("selected-word"),c.find(".space").addClass("selected-space")):(c.removeClass("selected-line"),c.find(".word").removeClass("selected-word"),c.find(".space").removeClass("selected-space")))},l.updateElemPos=function(){var e=this,t=e.config,l=e.selectedWords.length;if(l>0){var o=e.selectedWords.eq(0),i=o.position().left-t.ctlElemWidth,s=o.position().top,n=e.selectedWords.eq(l-1),a=n.position().left+n.width(),r=n.position().top;e.startElem.css({left:i,top:s}),e.endElem.css({left:a,top:r}),e.setSliderByClip({target:"start",startTop:s,endTop:r})}},l.setClipInfo=function(){var e=this,t=e.config;e.selectedWords=e.ctlScrollObj.find(".selected-word");var l=e.selectedWords.length;t.clipStartTime=e.selectedWords.eq(0).attr("st"),t.clipEndTime=e.selectedWords.eq(l-1).attr("et")},l.getFragmentUrl=function(e,l){var o=this,i=o.config,s="/fragment/create/"+JLib.config.playerGUID+"?st="+e+"&et="+l;$.get(s,{},function(e){e=t(e),1==e.status?(i.shareUrl=JLib.config.hostname+"/fragment/"+e.fragment_guid,JLib.config.fragment_guid=e.fragment_guid):alert(e.message)}).fail(function(){})},l.clipPreview=function(e,t){{var l=this;l.config}l.player&&l.player.pause(),console.log(l.previewIframe),l.previewIframe[0].src="";var o="/review?guid="+JLib.config.playerGUID+"&st="+e+"&et="+t;l.previewCont.removeClass("hidden"),l.previewIframe[0].src=o},{subtitleSelect:e}});
//# sourceMappingURL=subtitleselect.bak.js.map